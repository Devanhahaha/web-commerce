name: SonarQube Analysis

on:
  push:
    branches:
      - devan-baru  # atau sesuaikan dengan branch yang Anda gunakan
  pull_request:
    branches:
      - devan-baru  # jika Anda ingin workflow berjalan saat ada pull request ke branch utama

jobs:
  build:
    runs-on: windows-latest  # Menggunakan runner Windows

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      # Set environment variables for SonarQube
      - name: Set environment variables
        run: echo "SONAR_HOST_URL=http://localhost:9000" >> $GITHUB_ENV

      # Install dependencies and download SonarQube Scanner
      - name: Install dependencies and run SonarQube Scanner
  run: |
    # Unduh dan ekstrak sonar-scanner
    Invoke-WebRequest -Uri "https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.8.0.2856-windows.zip" -OutFile "sonar-scanner.zip"
    Expand-Archive -Path "sonar-scanner.zip" -DestinationPath "sonar-scanner"

    # Periksa isi folder sonar-scanner
    Get-ChildItem -Path "$(pwd)\sonar-scanner"

    # Tambahkan ke PATH
    $env:PATH += ";$(pwd)\sonar-scanner\bin"


      # Run SonarQube Scanner
      - name: Run SonarQube Scanner
        env:
          SONAR_HOST_URL: 'http://localhost:9000'  # URL server SonarQube
          SONAR_TOKEN: ${{ secrets.SONARQUBE_TOKEN }}  # Token API SonarQube
        run: |
          # Cek path lengkap ke sonar-scanner dan jalankan
          & "$(pwd)\sonar-scanner\bin\sonar-scanner.bat" --version
          & "$(pwd)\sonar-scanner\bin\sonar-scanner.bat"
